{"version":3,"file":"split-view-stack.js","sourceRoot":"","sources":["../../src/split-view/split-view-stack.tsx"],"names":[],"mappings":";AAAA,YAAY,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEb,+CAOe;AACf,mFAAkE;AAClE,+DAAoE;AAGpE,4EAAyE;AACzE,kDAA0C;AAY1C,MAAM,YAAY,GAAiB,CAAC,SAAS,EAAE,eAAe,EAAE,WAAW,CAAC,CAAC;AAE7E,SAAS,cAAc,CAAC,MAAkB;IACxC,OAAO,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AACtC,CAAC;AAEY,QAAA,cAAc,GAAG,IAAA,kBAAU,EACtC,SAAS,cAAc,CAAC,EAAE,cAAc,EAAE,EAAE,GAAG;IAC7C,MAAM,gBAAgB,GAAG,cAAc,CAAC,MAAM,IAAI,CAAC,CAAC;IACpD,MAAM,CAAC,cAAc,EAAE,iBAAiB,CAAC,GAAG,IAAA,gBAAQ,EAAe,CAAC,SAAS,CAAC,CAAC,CAAC;IAChF,MAAM,iBAAiB,GAAG,IAAA,cAAM,EAAC,cAAc,CAAC,CAAC;IACjD,iBAAiB,CAAC,OAAO,GAAG,cAAc,CAAC;IAE3C,MAAM,IAAI,GAAG,IAAA,mBAAW,EACtB,CAAC,MAAqC,EAAE,EAAE;QACxC,IAAI,MAAM,KAAK,eAAe,IAAI,MAAM,KAAK,WAAW,EAAE,CAAC;YACzD,MAAM,IAAI,KAAK,CACb,qCAAqC,MAAM,CAAC,MAAM,CAAC,8DAA8D,CAClH,CAAC;QACJ,CAAC;QAED,IAAI,MAAM,KAAK,eAAe,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACpD,MAAM,IAAI,KAAK,CACb,8FAA8F,CAC/F,CAAC;QACJ,CAAC;QAED,MAAM,OAAO,GAAG,iBAAiB,CAAC,OAAO,CAAC;QAE1C,2BAA2B;QAC3B,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;YAC7B,OAAO;QACT,CAAC;QAED,MAAM,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC/C,MAAM,WAAW,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC;QAC3C,MAAM,QAAQ,GAAG,cAAc,CAAC,UAAU,CAAC,CAAC;QAE5C,IAAI,WAAW,IAAI,QAAQ,EAAE,CAAC;YAC5B,MAAM,IAAI,KAAK,CACb,kCAAkC,MAAM,WAAW,UAAU,8BAA8B,CAC5F,CAAC;QACJ,CAAC;QAED,IAAI,MAAM,KAAK,WAAW,IAAI,gBAAgB,IAAI,UAAU,KAAK,SAAS,EAAE,CAAC;YAC3E,MAAM,IAAI,KAAK,CACb,iGAAiG,CAClG,CAAC;QACJ,CAAC;QAED,MAAM,IAAI,GAAG,CAAC,GAAG,OAAO,EAAE,MAAM,CAAC,CAAC;QAClC,iBAAiB,CAAC,OAAO,GAAG,IAAI,CAAC;QACjC,iBAAiB,CAAC,IAAI,CAAC,CAAC;IAC1B,CAAC,EACD,CAAC,gBAAgB,CAAC,CACnB,CAAC;IAEF,IAAA,2BAAmB,EAAC,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;IAEnD,MAAM,eAAe,GAAG,IAAA,mBAAW,EACjC,CAAC,KAAgD,EAAE,EAAE;QACnD,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,YAAY,CAAC;QAC7C,iBAAiB,CAAC,CAAC,OAAO,EAAE,EAAE;YAC5B,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC;gBAAE,OAAO,OAAO,CAAC;YACxC,MAAM,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,MAAM,GAAG,KAAK,CAAC,CAAC,CAAC;YACnE,iBAAiB,CAAC,OAAO,GAAG,IAAI,CAAC;YACjC,OAAO,IAAI,CAAC;QACd,CAAC,CAAC,CAAC;IACL,CAAC,EACD,EAAE,CACH,CAAC;IAEF,MAAM,gBAAgB,GAAG,CAAC,MAAkB,EAAmB,EAAE;QAC/D,IAAI,MAAM,KAAK,SAAS,EAAE,CAAC;YACzB,OAAO,cAAc,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,QAAQ,IAAI,IAAI,CAAC;QACnD,CAAC;QACD,IAAI,MAAM,KAAK,eAAe,EAAE,CAAC;YAC/B,OAAO,cAAc,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,QAAQ,IAAI,IAAI,CAAC;QACnD,CAAC;QACD,8CAA8C;QAC9C,OAAO,CACL,CAAC,6CAAqB,CAAC,KAAK,CAC1B;UAAA,CAAC,gBAAI,CAAC,AAAD,EACP;QAAA,EAAE,6CAAqB,CAAC,CACzB,CAAC;IACJ,CAAC,CAAC;IAEF,OAAO,CACL,CAAC,kCAAW,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAC9B;QAAA,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC,CACrC,CAAC,sCAAe,CACd,GAAG,CAAC,CAAC,MAAM,CAAC,CACZ,QAAQ,CAAC,CAAC,MAAM,CAAC,CACjB,aAAa,CAAC,CAAC,CAAC,CAAC,CACjB,iBAAiB,CAAC,MAAM,CACxB,cAAc,CAAC,SAAS,CACxB,cAAc,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAC1B,WAAW,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,SAAS,CAAC,CACrD;YAAA,CAAC,iDAAgB,CAAC,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE,iDAAgB,CAChE;UAAA,EAAE,sCAAe,CAAC,CACnB,CAAC,CACJ;MAAA,EAAE,kCAAW,CAAC,CACf,CAAC;AACJ,CAAC,CACF,CAAC","sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useCallback,\n  useImperativeHandle,\n  useRef,\n  useState,\n  type ReactElement,\n} from 'react';\nimport { SafeAreaProvider } from 'react-native-safe-area-context';\nimport { ScreenStack, ScreenStackItem } from 'react-native-screens';\n\nimport type { SplitViewColumnProps } from './elements';\nimport { IsWithinLayoutContext } from '../layouts/IsWithinLayoutContext';\nimport { Slot } from '../views/Navigator';\n\nexport type ColumnName = 'primary' | 'supplementary' | 'secondary';\n\nexport interface SplitViewRef {\n  show: (column: 'supplementary' | 'secondary') => void;\n}\n\ninterface SplitViewStackProps {\n  columnChildren: ReactElement<SplitViewColumnProps>[];\n}\n\nconst COLUMN_ORDER: ColumnName[] = ['primary', 'supplementary', 'secondary'];\n\nfunction getColumnIndex(column: ColumnName): number {\n  return COLUMN_ORDER.indexOf(column);\n}\n\nexport const SplitViewStack = forwardRef<SplitViewRef, SplitViewStackProps>(\n  function SplitViewStack({ columnChildren }, ref) {\n    const hasSupplementary = columnChildren.length >= 2;\n    const [visibleColumns, setVisibleColumns] = useState<ColumnName[]>(['primary']);\n    const visibleColumnsRef = useRef(visibleColumns);\n    visibleColumnsRef.current = visibleColumns;\n\n    const show = useCallback(\n      (column: 'supplementary' | 'secondary') => {\n        if (column !== 'supplementary' && column !== 'secondary') {\n          throw new Error(\n            `SplitView.show(): Invalid column \"${String(column)}\". Only \"supplementary\" and \"secondary\" are valid arguments.`\n          );\n        }\n\n        if (column === 'supplementary' && !hasSupplementary) {\n          throw new Error(\n            'SplitView.show(): Cannot show \"supplementary\" column because no supplementary column exists.'\n          );\n        }\n\n        const current = visibleColumnsRef.current;\n\n        // No-op if already visible\n        if (current.includes(column)) {\n          return;\n        }\n\n        const currentTop = current[current.length - 1];\n        const targetIndex = getColumnIndex(column);\n        const topIndex = getColumnIndex(currentTop);\n\n        if (targetIndex <= topIndex) {\n          throw new Error(\n            `SplitView.show(): Cannot show \"${column}\" when \"${currentTop}\" is already visible on top.`\n          );\n        }\n\n        if (column === 'secondary' && hasSupplementary && currentTop === 'primary') {\n          throw new Error(\n            'SplitView.show(): Cannot skip \"supplementary\" column. Show it first before showing \"secondary\".'\n          );\n        }\n\n        const next = [...current, column];\n        visibleColumnsRef.current = next;\n        setVisibleColumns(next);\n      },\n      [hasSupplementary]\n    );\n\n    useImperativeHandle(ref, () => ({ show }), [show]);\n\n    const handleDismissed = useCallback(\n      (event: { nativeEvent: { dismissCount: number } }) => {\n        const count = event.nativeEvent.dismissCount;\n        setVisibleColumns((current) => {\n          if (current.length <= 1) return current;\n          const next = current.slice(0, Math.max(1, current.length - count));\n          visibleColumnsRef.current = next;\n          return next;\n        });\n      },\n      []\n    );\n\n    const getColumnContent = (column: ColumnName): React.ReactNode => {\n      if (column === 'primary') {\n        return columnChildren[0]?.props.children ?? null;\n      }\n      if (column === 'supplementary') {\n        return columnChildren[1]?.props.children ?? null;\n      }\n      // secondary renders the Slot (router content)\n      return (\n        <IsWithinLayoutContext value>\n          <Slot />\n        </IsWithinLayoutContext>\n      );\n    };\n\n    return (\n      <ScreenStack style={{ flex: 1 }}>\n        {visibleColumns.map((column, index) => (\n          <ScreenStackItem\n            key={column}\n            screenId={column}\n            activityState={2}\n            stackPresentation=\"push\"\n            stackAnimation=\"default\"\n            gestureEnabled={index > 0}\n            onDismissed={index > 0 ? handleDismissed : undefined}>\n            <SafeAreaProvider>{getColumnContent(column)}</SafeAreaProvider>\n          </ScreenStackItem>\n        ))}\n      </ScreenStack>\n    );\n  }\n);\n"]}